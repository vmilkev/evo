
clear;
%close all;

% file_ld = ["ld_at_0_chr_0.ld", "ld_at_10_chr_0.ld", "ld_at_20_chr_0.ld", ...
%             "ld_at_30_chr_0.ld", "ld_at_40_chr_0.ld", "ld_at_50_chr_0.ld", ...
%             "ld_at_60_chr_0.ld", "ld_at_70_chr_0.ld", "ld_at_80_chr_0.ld", ...
%             "ld_at_99_chr_0.ld"];
% file_fq = ["ld_at_0_chr_0.fq", "ld_at_10_chr_0.fq", "ld_at_20_chr_0.fq", ...
%             "ld_at_30_chr_0.fq", "ld_at_40_chr_0.fq", "ld_at_50_chr_0.fq", ...
%             "ld_at_60_chr_0.fq", "ld_at_70_chr_0.fq", "ld_at_80_chr_0.fq", ...
%             "ld_at_99_chr_0.fq"];

file_ld = ["ld_at_0_chr_0.ld", "ld_at_100_chr_0.ld", "ld_at_200_chr_0.ld", "ld_at_300_chr_0.ld", "ld_at_400_chr_0.ld", ...
           "ld_at_500_chr_0.ld", "ld_at_600_chr_0.ld", "ld_at_700_chr_0.ld", "ld_at_800_chr_0.ld", "ld_at_900_chr_0.ld", ...
           "ld_at_999_chr_0.ld"];
file_fq = ["ld_at_0_chr_0.fq", "ld_at_100_chr_0.fq", "ld_at_200_chr_0.fq", "ld_at_300_chr_0.fq", "ld_at_400_chr_0.fq", ...
           "ld_at_500_chr_0.fq", "ld_at_600_chr_0.fq", "ld_at_700_chr_0.fq", "ld_at_800_chr_0.fq", "ld_at_900_chr_0.fq", ...
           "ld_at_999_chr_0.fq"];

% file_ld = ["ld_at_1000_chr_0.ld","ld_at_2000_chr_0.ld","ld_at_3000_chr_0.ld","ld_at_4000_chr_0.ld","ld_at_5000_chr_0.ld","ld_at_6000_chr_0.ld","ld_at_7000_chr_0.ld","ld_at_8000_chr_0.ld","ld_at_9999_chr_0.ld"];
% file_fq = ["ld_at_1000_chr_0.fq","ld_at_2000_chr_0.fq","ld_at_3000_chr_0.fq","ld_at_4000_chr_0.fq","ld_at_5000_chr_0.fq","ld_at_6000_chr_0.fq","ld_at_7000_chr_0.fq","ld_at_8000_chr_0.fq","ld_at_9999_chr_0.fq"];

% file_ld = ["ld_at_399_chr_0.ld"];
% file_fq = ["ld_at_399_chr_0.fq"];

figure(1);
clf;
set(gcf,'Color','white');

for j = 1:size(file_ld,2)

    ld = import_ld(file_ld(j));
    f = import_ld(file_fq(j));

    ld_shifted = zeros(size(ld));
    
    nsnp = size(ld,1);
    mean_ld = zeros(1,nsnp);
    [fi,xi] = ksdensity(f); 
    
    p1 = subplot(1,2,1);
    cla(p1);
    hold on;
    for i = 1:nsnp-1
        range = i:nsnp;
        range2 = range-i+1;
        plot(1:nsnp-i+1, ld(i,i:nsnp), 'k.');
        mean_ld(1,1:nsnp-i+1) = mean_ld(1,1:nsnp-i+1) + ld(i,i:nsnp);
        ld_shifted(i)
    end
    for i = 1:nsnp-1
        mean_ld(1,i) = mean_ld(1,i)/(nsnp-i+1);
    end
    plot(1:nsnp, mean_ld, '*', 'LineWidth',2.0);
    box on;
    grid on;
    axis square;
    ylim([0 1]);
    
    p2 = subplot(1,2,2);
    cla(p2);
    hold on
    %plot(xi,fi);
    histogram(f);
    box on;
    axis square;
    grid on;
    
    disp(j);

    %hm = HeatMap(ld); hm.Symmetric = false;
end

figure(2);
clf;
hm = heatmap(ld+ld'-eye(size(ld)));
%close all hidden

%
% figure(2);
% clf;
% set(gcf,'Color','white');
% mean_ld2 = zeros(1,nsnp);
% 
% hold on;
% 
% for i = 1:nsnp-1
%     mean_ld2(1,1:nsnp-i+1) = mean_ld2(1,1:nsnp-i+1) + ld(i,i:nsnp);
%     plot(1:nsnp-i+1, ld(i,i:nsnp), 'k.');
% end
% 
% for i = 1:nsnp-1
%     mean_ld2(1,i) = mean_ld2(1,i)/(nsnp-i);
% end
% plot(1:nsnp, mean_ld2, 'k*-', 'LineWidth',2.0);
% 
% box on;
% grid on;
% axis square;
% ylim([0 1]);

%% Functions
function ld = import_ld(filename)
ld = readtable(filename, "FileType","text");
ld = table2array(ld);
end

function f = import_freq(filename)
    dataLines = [1, Inf];
    opts = delimitedTextImportOptions("NumVariables", 1);
    opts.DataLines = dataLines;
    opts.Delimiter = ",";
    opts.VariableNames = "VarName1";
    opts.VariableTypes = "double";
    opts.ExtraColumnsRule = "ignore";
    opts.EmptyLineRule = "read";
    f = readtable(filename, opts);
    f = table2array(f);
end